# Bank Card Management System (Backend)

Backend-система на базе **Spring Boot 3**, предназначенная для управления жизненным циклом банковских карт. Проект включает в себя механизмы безопасного хранения данных, маскирования номеров и ролевую модель доступа.

## Основные возможности

### Для Пользователей (`ROLE_USER`)

* **Просмотр:** Список собственных карт с пагинацией и фильтрацией (в маскированном виде).
* **Детализация:** Просмотр полного номера и баланса по последним 4 цифрам из номера и после проверки PIN-кода.
* **Безопасность:** Запрос на блокировку карты в случае утери.
* **Транзакции:** Переводы между своими картами по полным номерам карт и после проверки PIN-кода.

### Для Администраторов (`ROLE_ADMIN`)

* **Управление пользователями:** Полный CRUD пользователей.
* **Управление картами:** Выпуск новых карт, принудительная блокировка, активация и удаление.
* **Аудит:** Просмотр всех карт в системе.

---

## Технологический стек

* **Java 21** + **Spring Boot 3.5.7**
* **Security:** Spring Security, JWT (Access + Refresh tokens)
* **Database:** PostgreSQL
* **Migrations:** Liquibase
* **Data Privacy:** AES-128 Encryption (для ФИО и номеров карт), BCrypt (для паролей)
* **Documentation:** Swagger UI / OpenAPI 3.1
* **DevOps:** Docker, Docker Compose

---

## Архитектура безопасности

1. **Шифрование (PII):** Личные данные (Имя, Фамилия) и номера карт шифруются на уровне БД с использованием `AttributeConverter` и алгоритма AES.
2. **Маскирование:** API по умолчанию возвращает маскированный номер карты (например, `**** **** **** 1234`). Полные данные доступны только через защищенный эндпоинт с проверкой PIN или для ROLE_ADMIN.
3. **JWT Flow:** Использование короткоживущих Access-токенов и Refresh-токенов для безопасного обновления сессии.

---

## Запуск проекта

### 1. Предварительные требования

* Установленный **Docker** и **Docker Compose**.
* (Опционально) **JDK 21**, если запуск планируется без Docker.

### 2. Настройка окружения

Создайте файл `.env` в корневом каталоге:

```env

DB_NAME=bank_rest_bd
DB_USERNAME=dytni
DB_PASSWORD=1331

ENCRYPTION_KEY=my0superpuper1secretkey2
JWT_SECRET=7dRVDush0yCgDxd90YzNkMnvvN0KTaa/k9cnkwUWrmU=

```

### 3. Запуск через Docker Compose

```bash
docker-compose up --build

```

Приложение будет доступно на порту `8080`.

### 4. Документация API

После запуска перейдите по адресу:

* **Swagger UI:** `http://localhost:8080/swagger-ui.html`
* **OpenAPI Spec:** `http://localhost:8080/v3/api-docs`


---

## Тестирование

Для запуска юнит-тестов бизнес-логики (сервисы и маскирование):

```bash
mvn test

```

---

## Важно

* **PIN-код:** Все чувствительные операции с картами требуют передачи 4-значного PIN-кода.
* **Liquibase:** Миграции применяются автоматически при старте приложения. Таблицы будут созданы в схеме `public`.

---
